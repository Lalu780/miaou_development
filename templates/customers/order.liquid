<main class="Customer" role="main">
<div class="row">
  <div class="medium-8 columns">
    <h1 class="Customer-sectionTitle">
      {{ 'customer.order.title' | t: name: order.name }}
    </h1>
    <p>
      {% assign creation_date = order.created_at | date: format: 'month_day_year' %}
      {{ 'customer.order.date' | t: date: creation_date }}
    </p>

    {% if order.cancelled %}
      {% assign cancellation_date = order.cancelled_at | date: format: 'month_day_year' %}
      <p>
        <strong>
          {{ 'customer.order.cancelled' | t: date: cancellation_date }}
          <br />
          {{ 'customer.order.cancelled_reason' | t: reason: order.cancel_reason }}
        </strong>
      </p>
    {% endif %}

    <div class="o-rte">
      <table>
        <thead>
          <tr>
            <th scope="col">
              {{ 'customer.order.product' | t }}
            </th>
            <th scope="col">
              {{ 'customer.order.sku' | t }}
            </th>
            <th scope="col">
              {{ 'customer.order.price' | t }}
            </th>
            <th scope="col" class="center">
              {{ 'customer.order.quantity' | t }}
            </th>
            <th scope="col" class="total">
              {{ 'customer.order.total' | t }}
            </th>
          </tr>
        </thead>
        <tbody>
          {% for line_item in order.line_items %}
            <tr>
              <td scope="row" data-title="{{ 'customer.order.product' | t }}" class="">
                {{ line_item.title | link_to: line_item.product.url }}

                <!-- Line Item Properties -->
                {% for p in line_item.properties %}
                  {% unless p.last == blank %}
                    <br /> - {{ p.first }}: {{ p.last }}
                  {% endunless %}
                {% endfor %}

                {% if line_item.fulfillment %}
                  <br />
                  <small>
                    {% assign fulfillment_date = line_item.fulfillment.created_at | date: format: 'month_day_year' %}
                    {{ 'customer.order.fulfilled_at' | t: date: fulfillment_date }}

                    {% if line_item.fulfillment.tracking_number %}
                      <br />
                      <a href="{{ line_item.fulfillment.tracking_url }}">
                        {{ line_item.fulfillment.tracking_company }} #{{ line_item.fulfillment.tracking_number}}
                      </a>
                    {% endif %}
                  </small>
                {% endif %}
              </td>
              <td data-title="{{ 'customer.order.sku' | t }}" class="sku note">
                {{ line_item.sku }}
              </td>
              <td data-title="{{ 'customer.order.price' | t }}" class="money">
                {{ line_item.price | money }}
              </td>
              <td data-title="{{ 'customer.order.quantity' | t }}" class="quantity cente">
                {{ line_item.quantity }}
              </td>
              <td data-title="{{ 'customer.order.total' | t }}" class="total money">
                {{ line_item.line_price | money }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr class="order_summary note">
            <td colspan="4">
              {{ 'customer.order.subtotal' | t }}
            </td>
            <td class="total money">
              {{ order.subtotal_price | money }}
            </td>
          </tr>

          {% for shipping_method in order.shipping_methods %}
            <tr class="order_summary note">
              <td colspan="4">
                {{ shipping_method.title }}
              </td>
              <td class="total money">
                {{ shipping_method.price | money }}
              </td>
            </tr>
          {% endfor %}

          {% for tax_line in order.tax_lines %}
            <tr class="order_summary note">
              <td colspan="4">
                {{ tax_line.title }} {{ tax_line.rate | times: 100 | append: '%' }}
              </td>
              <td class="total money">
                {{ tax_line.price | money }}
              </td>
            </tr>
          {% endfor %}

          <tr class="order_summary order_total">
            <td colspan="4">
              {{ 'customer.order.total' | t }}
            </td>
            <td class="total money">
              {{ order.total_price | money }}
            </td>
          </tr>
        </tfoot>
      </table>

    </div>
  </div>

  <div class="medium-4 columns">
    <div class="o-rte">
      <h2 class="Customer-sectionTitle">
        {{ 'customer.order.billing_address' | t }}
      </h2>
      <h6>
        {{ 'customer.order.payment_status' | t | append: ':' }}
        {{ order.financial_status }}
      </h6>
      <div class="Customer-address">
        <p>
          {{ order.billing_address.address1 }}
          {% if order.billing_address.address2 != blank %}
            {{ order.billing_address.address2 }}
          {% endif %}
          <br />
          {{ order.billing_address.city }},
          {% if address.province_code %}
            {{ order.billing_address.province_code | append: ',' }}
          {% endif %}
          <br />
          {{ order.billing_address.zip }}
          {{ order.billing_address.country }}
        </p>
        {% if order.default_address.phone and order.default_address.phone != blank %}
          <p>{{ order.default_address.phone }}</p>
        {% endif %}
      </div>

      {% if order.shipping_address %}
        <h2 class="Customer-sectionTitle">
        {{ 'customer.order.shipping_address' | t }}
        </h2>
        <h6>
          {{ 'customer.order.fulfillment_status' | t | append: ':' }}
          {{ order.fulfillment_status }}
        </h6>
        <div class="Customer-address">
          <p>
            {{ order.shipping_address.address1 }}
            {% if order.shipping_address.address2 != blank %}
              {{ order.shipping_address.address2 }}
            {% endif %}
            <br />
            {{ order.shipping_address.city }},
            {% if address.province_code %}
              {{ order.shipping_address.province_code | append: ',' }}
            {% endif %}
            <br />
            {{ order.shipping_address.zip }}
            {{ order.shipping_address.country }}
          </p>
          {% if order.default_address.phone and order.default_address.phone != blank %}
            <p>{{ order.default_address.phone }}</p>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

<div class="column row">
  <a class="Customer-backButton o-button" href="/account">
    {{ 'customer.account.return' | t }}
  </a>
</div>
</main>
